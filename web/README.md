# ğŸ¨ Conditional Access Gap Explorer - Web UI

Interactive React + TypeScript visualization for Conditional Access policy analysis.

## ğŸš€ Quick Start

### Prerequisites
- Node.js 18+ and npm
- Data files generated by PowerShell scripts (automatically copied to `public/` by `run-all.ps1`)

### Development Mode
```bash
npm install
npm run dev
```

Open http://localhost:5173

### Production Build
```bash
npm run build
npm run preview
```

---

## ğŸ“Š Features

### Visualization
- **Force-directed graph** with D3 and Dagre layout
- **Interactive nodes** - click to view details
- **Color-coded entities** - policies, users, groups, roles, applications, locations
- **Zoom and pan** - navigate large policy sets

### Gap Detection
- Policies without any assignments (orphaned policies)
- Policies with only exclusions (no includes)
- Users/groups without policy coverage
- Risk-based policies (sign-in risk, user risk)

### Detail Panel
- Full policy configuration (conditions, grant controls, session controls)
- Assignment expansion showing all affected users/groups
- Nested group membership paths ("User A via Group B via Group C")
- Application and location details

### Filters & Search
- Filter by entity type
- Filter by policy state (enabled/disabled/report-only)
- Search by name or ID
- Export filtered views

---

## ğŸ”„ Data Refresh Workflow

### Automated (Recommended)
Run the complete pipeline from the project root:
```powershell
cd ..
./scripts/run-all.ps1 -SkipConnect
cd web
# Dev server auto-reloads with new data
```

The `run-all.ps1` script automatically:
1. Collects policies
2. Collects directory objects
3. Builds graph JSON
4. **Copies all outputs to `web/public/`**

### Manual
```powershell
# From project root
cd scripts
./collect-conditional-access.ps1 -SkipConnect -SkipDisconnect
./collect-directory-objects.ps1 -SkipConnect
./build-graph-json.ps1

# Copy to web/public manually
cp ../output/conditional_access_graph.json ../web/public/
cp ../output/conditional_access_policies.json ../web/public/
cp ../output/entities/*.json ../web/public/entities/
```

---

## ğŸ“‚ Required Data Files

The app expects these files in `public/`:

- `conditional_access_graph.json` - Graph structure (nodes + edges)
- `conditional_access_policies.json` - Full policy data
- `entities/users.json` - User directory
- `entities/groups.json` - Group directory  
- `entities/roles.json` - Directory roles
- `entities/service_principals.json` - Applications
- `entities/named_locations.json` - Named locations

All generated automatically by `run-all.ps1`.

---

## ğŸ¨ Customization

### Styling
- **Color scheme**: `src/App.css` - update CSS variables
- **Graph layout**: `src/components/GraphView.css` - node/edge styles
- **Component themes**: Individual component `.css` files

### Gap Detection Logic
- **Add heuristics**: `src/components/GapHighlights.tsx`
- **Custom filters**: `src/utils/graphFilters.ts`

### Data Loading
- **API integration**: Modify `src/data/loadGraphData.ts` to fetch from backend
- **Real-time updates**: Add WebSocket or polling logic

---

## ğŸ—ï¸ Project Structure

```
web/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/        # React components
â”‚   â”‚   â”œâ”€â”€ GraphView.tsx  # Main graph visualization
â”‚   â”‚   â”œâ”€â”€ GapHighlights.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ utils/             # Helper functions
â”‚   â”‚   â”œâ”€â”€ graphFilters.ts
â”‚   â”‚   â””â”€â”€ graphLayout.ts
â”‚   â”œâ”€â”€ types/             # TypeScript definitions
â”‚   â””â”€â”€ data/              # Data loading
â”œâ”€â”€ public/                # Static assets + data files
â”‚   â”œâ”€â”€ conditional_access_graph.json
â”‚   â”œâ”€â”€ conditional_access_policies.json
â”‚   â””â”€â”€ entities/
â””â”€â”€ dist/                  # Production build output
```

---

## ğŸ› Troubleshooting

### "No data to display"
- Ensure data files exist in `public/`
- Run `../scripts/run-all.ps1 -SkipConnect` to generate data
- Check browser console for fetch errors

### Graph not rendering
- Check that `conditional_access_graph.json` has `nodes` and `edges` arrays
- Verify JSON is valid (use `jsonlint` or browser console)

### Large datasets slow
- Use production build (`npm run build`) for better performance
- Consider filtering policies before visualization
- Limit nested group expansion depth in collector script

---

## ğŸ“š Tech Stack

- **React 18** - UI framework
- **TypeScript** - Type safety
- **D3.js** - Graph rendering and force simulation
- **Dagre** - Hierarchical graph layout
- **Vite** - Build tool and dev server

---

See the main [README](../README.md) for complete setup instructions and data collection workflows.